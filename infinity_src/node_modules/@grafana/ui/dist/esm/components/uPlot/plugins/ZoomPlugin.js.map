{"version":3,"file":"ZoomPlugin.js","sources":["../../../../../src/components/uPlot/plugins/ZoomPlugin.tsx"],"sourcesContent":["import { useEffect, useLayoutEffect, useState } from 'react';\n\nimport { UPlotConfigBuilder } from '../config/UPlotConfigBuilder';\nimport { PlotSelection } from '../types';\nimport { pluginLog } from '../utils';\n\ninterface ZoomPluginProps {\n  onZoom: (range: { from: number; to: number }) => void;\n  config: UPlotConfigBuilder;\n}\n\n// min px width that triggers zoom\nconst MIN_ZOOM_DIST = 5;\n\n/**\n * @alpha\n */\nexport const ZoomPlugin = ({ onZoom, config }: ZoomPluginProps) => {\n  const [selection, setSelection] = useState<PlotSelection | null>(null);\n\n  useEffect(() => {\n    if (selection) {\n      pluginLog('ZoomPlugin', false, 'selected', selection);\n      if (selection.bbox.width < MIN_ZOOM_DIST) {\n        return;\n      }\n      onZoom({ from: selection.min, to: selection.max });\n    }\n  }, [selection]);\n\n  useLayoutEffect(() => {\n    config.addHook('setSelect', (u) => {\n      const min = u.posToVal(u.select.left, 'x');\n      const max = u.posToVal(u.select.left + u.select.width, 'x');\n\n      setSelection({\n        min,\n        max,\n        bbox: {\n          left: u.bbox.left / window.devicePixelRatio + u.select.left,\n          top: u.bbox.top / window.devicePixelRatio,\n          height: u.bbox.height / window.devicePixelRatio,\n          width: u.select.width,\n        },\n      });\n\n      // manually hide selected region (since cursor.drag.setScale = false)\n      /* @ts-ignore */\n      u.setSelect({ left: 0, width: 0 }, false);\n    });\n  }, [config]);\n\n  return null;\n};\n"],"names":[],"mappings":";;;AAYA,MAAM,aAAgB,GAAA,CAAA,CAAA;AAKf,MAAM,UAAa,GAAA,CAAC,EAAE,MAAA,EAAQ,QAA8B,KAAA;AACjE,EAAA,MAAM,CAAC,SAAA,EAAW,YAAY,CAAA,GAAI,SAA+B,IAAI,CAAA,CAAA;AAErE,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,IAAI,SAAW,EAAA;AACb,MAAU,SAAA,CAAA,YAAA,EAAc,KAAO,EAAA,UAAA,EAAY,SAAS,CAAA,CAAA;AACpD,MAAI,IAAA,SAAA,CAAU,IAAK,CAAA,KAAA,GAAQ,aAAe,EAAA;AACxC,QAAA,OAAA;AAAA,OACF;AACA,MAAA,MAAA,CAAO,EAAE,IAAM,EAAA,SAAA,CAAU,KAAK,EAAI,EAAA,SAAA,CAAU,KAAK,CAAA,CAAA;AAAA,KACnD;AAAA,GACF,EAAG,CAAC,SAAS,CAAC,CAAA,CAAA;AAEd,EAAA,eAAA,CAAgB,MAAM;AACpB,IAAO,MAAA,CAAA,OAAA,CAAQ,WAAa,EAAA,CAAC,CAAM,KAAA;AACjC,MAAA,MAAM,MAAM,CAAE,CAAA,QAAA,CAAS,CAAE,CAAA,MAAA,CAAO,MAAM,GAAG,CAAA,CAAA;AACzC,MAAM,MAAA,GAAA,GAAM,EAAE,QAAS,CAAA,CAAA,CAAE,OAAO,IAAO,GAAA,CAAA,CAAE,MAAO,CAAA,KAAA,EAAO,GAAG,CAAA,CAAA;AAE1D,MAAa,YAAA,CAAA;AAAA,QACX,GAAA;AAAA,QACA,GAAA;AAAA,QACA,IAAM,EAAA;AAAA,UACJ,MAAM,CAAE,CAAA,IAAA,CAAK,OAAO,MAAO,CAAA,gBAAA,GAAmB,EAAE,MAAO,CAAA,IAAA;AAAA,UACvD,GAAK,EAAA,CAAA,CAAE,IAAK,CAAA,GAAA,GAAM,MAAO,CAAA,gBAAA;AAAA,UACzB,MAAQ,EAAA,CAAA,CAAE,IAAK,CAAA,MAAA,GAAS,MAAO,CAAA,gBAAA;AAAA,UAC/B,KAAA,EAAO,EAAE,MAAO,CAAA,KAAA;AAAA,SAClB;AAAA,OACD,CAAA,CAAA;AAID,MAAA,CAAA,CAAE,UAAU,EAAE,IAAA,EAAM,GAAG,KAAO,EAAA,CAAA,IAAK,KAAK,CAAA,CAAA;AAAA,KACzC,CAAA,CAAA;AAAA,GACH,EAAG,CAAC,MAAM,CAAC,CAAA,CAAA;AAEX,EAAO,OAAA,IAAA,CAAA;AACT;;;;"}