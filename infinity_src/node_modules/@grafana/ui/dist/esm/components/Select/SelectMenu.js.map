{"version":3,"file":"SelectMenu.js","sources":["../../../../src/components/Select/SelectMenu.tsx"],"sourcesContent":["import { cx } from '@emotion/css';\nimport { max } from 'lodash';\nimport React, { RefCallback } from 'react';\nimport { MenuListProps } from 'react-select';\nimport { FixedSizeList as List } from 'react-window';\n\nimport { SelectableValue, toIconName } from '@grafana/data';\n\nimport { useTheme2 } from '../../themes/ThemeContext';\nimport { CustomScrollbar } from '../CustomScrollbar/CustomScrollbar';\nimport { Icon } from '../Icon/Icon';\n\nimport { getSelectStyles } from './getSelectStyles';\n\ninterface SelectMenuProps {\n  maxHeight: number;\n  innerRef: RefCallback<HTMLDivElement>;\n  innerProps: {};\n}\n\nexport const SelectMenu = ({ children, maxHeight, innerRef, innerProps }: React.PropsWithChildren<SelectMenuProps>) => {\n  const theme = useTheme2();\n  const styles = getSelectStyles(theme);\n\n  return (\n    <div {...innerProps} className={styles.menu} style={{ maxHeight }} aria-label=\"Select options menu\">\n      <CustomScrollbar scrollRefCallback={innerRef} autoHide={false} autoHeightMax=\"inherit\" hideHorizontalTrack>\n        {children}\n      </CustomScrollbar>\n    </div>\n  );\n};\n\nSelectMenu.displayName = 'SelectMenu';\n\nconst VIRTUAL_LIST_ITEM_HEIGHT = 37;\nconst VIRTUAL_LIST_WIDTH_ESTIMATE_MULTIPLIER = 7;\n\n// A virtualized version of the SelectMenu, descriptions for SelectableValue options not supported since those are of a variable height.\n//\n// To support the virtualized list we have to \"guess\" the width of the menu container based on the longest available option.\n// the reason for this is because all of the options will be positioned absolute, this takes them out of the document and no space\n// is created for them, thus the container can't grow to accomodate.\n//\n// VIRTUAL_LIST_ITEM_HEIGHT and WIDTH_ESTIMATE_MULTIPLIER are both magic numbers.\n// Some characters (such as emojis and other unicode characters) may consist of multiple code points in which case the width would be inaccurate (but larger than needed).\nexport const VirtualizedSelectMenu = ({ children, maxHeight, options, getValue }: MenuListProps<SelectableValue>) => {\n  const theme = useTheme2();\n  const styles = getSelectStyles(theme);\n  const [value] = getValue();\n\n  const valueIndex = value ? options.findIndex((option: SelectableValue<unknown>) => option.value === value.value) : 0;\n  const initialOffset = valueIndex * VIRTUAL_LIST_ITEM_HEIGHT;\n\n  if (!Array.isArray(children)) {\n    return null;\n  }\n\n  const longestOption = max(options.map((option) => option.label?.length)) ?? 0;\n  const widthEstimate = longestOption * VIRTUAL_LIST_WIDTH_ESTIMATE_MULTIPLIER;\n  const heightEstimate = Math.min(options.length * VIRTUAL_LIST_ITEM_HEIGHT, maxHeight);\n\n  return (\n    <List\n      className={styles.menu}\n      height={heightEstimate}\n      width={widthEstimate}\n      aria-label=\"Select options menu\"\n      itemCount={children.length}\n      itemSize={VIRTUAL_LIST_ITEM_HEIGHT}\n      initialScrollOffset={initialOffset}\n    >\n      {({ index, style }) => <div style={{ ...style, overflow: 'hidden' }}>{children[index]}</div>}\n    </List>\n  );\n};\n\nVirtualizedSelectMenu.displayName = 'VirtualizedSelectMenu';\n\ninterface SelectMenuOptionProps<T> {\n  isDisabled: boolean;\n  isFocused: boolean;\n  isSelected: boolean;\n  innerProps: JSX.IntrinsicElements['div'];\n  innerRef: RefCallback<HTMLDivElement>;\n  renderOptionLabel?: (value: SelectableValue<T>) => JSX.Element;\n  data: SelectableValue<T>;\n}\n\nexport const SelectMenuOptions = ({\n  children,\n  data,\n  innerProps,\n  innerRef,\n  isFocused,\n  isSelected,\n  renderOptionLabel,\n}: React.PropsWithChildren<SelectMenuOptionProps<any>>) => {\n  const theme = useTheme2();\n  const styles = getSelectStyles(theme);\n  const icon = data.icon ? toIconName(data.icon) : undefined;\n\n  return (\n    <div\n      ref={innerRef}\n      className={cx(\n        styles.option,\n        isFocused && styles.optionFocused,\n        isSelected && styles.optionSelected,\n        data.isDisabled && styles.optionDisabled\n      )}\n      {...innerProps}\n      aria-label=\"Select option\"\n      title={data.title}\n    >\n      {icon && <Icon name={icon} className={styles.optionIcon} />}\n      {data.imgUrl && <img className={styles.optionImage} src={data.imgUrl} alt={data.label || data.value} />}\n      <div className={styles.optionBody}>\n        <span>{renderOptionLabel ? renderOptionLabel(data) : children}</span>\n        {data.description && <div className={styles.optionDescription}>{data.description}</div>}\n        {data.component && <data.component />}\n      </div>\n    </div>\n  );\n};\n\nSelectMenuOptions.displayName = 'SelectMenuOptions';\n"],"names":["React","_a","List"],"mappings":"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"}