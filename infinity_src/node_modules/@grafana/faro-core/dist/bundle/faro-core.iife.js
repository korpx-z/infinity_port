var GrafanaFaroCore=function(e){"use strict";function t(e,t){return typeof e===t}function n(e,t){return Object.prototype.toString.call(e)===`[object ${t}]`}function r(e,t){try{return e instanceof t}catch(e){return!1}}const o=e=>t(e,"undefined"),a=e=>t(e,"null"),i=e=>t(e,"string"),s=e=>t(e,"number")&&!isNaN(e)||t(e,"bigint"),l=e=>!a(e)&&t(e,"object"),u=e=>t(e,"function"),c=e=>n(e,"Array"),d=!o(Event),g="undefined"!=typeof Error,p="undefined"!=typeof Element,f="undefined"!=typeof Map;function m(e,n){if(e===n)return!0;if(t(e,"number")&&isNaN(e))return t(n,"number")&&isNaN(n);const r=c(e),o=c(n);if(r!==o)return!1;if(r&&o){const t=e.length;if(t!==n.length)return!1;for(let r=t;0!=r--;)if(!m(e[r],n[r]))return!1;return!0}const a=l(e),i=l(n);if(a!==i)return!1;if(e&&n&&a&&i){const t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(let e of t)if(!r.includes(e))return!1;for(let r of t)if(!m(e[r],n[r]))return!1;return!0}return!1}function v(){return(new Date).toISOString()}var h;e.LogLevel=void 0,(h=e.LogLevel||(e.LogLevel={})).TRACE="trace",h.DEBUG="debug",h.INFO="info",h.LOG="log",h.WARN="warn",h.ERROR="error";const b=e.LogLevel.LOG,E=[e.LogLevel.TRACE,e.LogLevel.DEBUG,e.LogLevel.INFO,e.LogLevel.LOG,e.LogLevel.WARN,e.LogLevel.ERROR];function y(){}const T="abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ0123456789";var I={exports:{}},O={exports:{}};O.exports=function(e,t){var n,r,o,a,i,s,l,u;for(n=3&e.length,r=e.length-n,o=t,i=3432918353,s=461845907,u=0;u<r;)l=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,o=27492+(65535&(a=5*(65535&(o=(o^=l=(65535&(l=(l=(65535&l)*i+(((l>>>16)*i&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|o>>>19))+((5*(o>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:o^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(u)))*i+(((l>>>16)*i&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return o^=e.length,o=2246822507*(65535&(o^=o>>>16))+((2246822507*(o>>>16)&65535)<<16)&4294967295,o=3266489909*(65535&(o^=o>>>13))+((3266489909*(o>>>16)&65535)<<16)&4294967295,(o^=o>>>16)>>>0};var L=O.exports,S={exports:{}};!function(e){e.exports=function(e,t){for(var n,r=e.length,o=t^r,a=0;r>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(n>>>16)&65535)<<16),o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++a;switch(r){case 3:o^=(255&e.charCodeAt(a+2))<<16;case 2:o^=(255&e.charCodeAt(a+1))<<8;case 1:o=1540483477*(65535&(o^=255&e.charCodeAt(a)))+((1540483477*(o>>>16)&65535)<<16)}return o=1540483477*(65535&(o^=o>>>13))+((1540483477*(o>>>16)&65535)<<16),(o^=o>>>15)>>>0}}(S);var x=L,A=S.exports;I.exports=x;var N=I.exports.murmur3=x;I.exports.murmur2=A;class R{constructor(e,t){var n,r;this.signalBuffer=[],this.itemLimit=null!==(n=null==t?void 0:t.itemLimit)&&void 0!==n?n:50,this.sendTimeout=null!==(r=null==t?void 0:t.sendTimeout)&&void 0!==r?r:250,this.paused=(null==t?void 0:t.paused)||!1,this.sendFn=e,this.flushInterval=-1,this.paused||this.start(),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&this.flush()}))}addItem(e){this.paused||(this.signalBuffer.push(e),this.signalBuffer.length>=this.itemLimit&&this.flush())}start(){this.paused=!1,this.sendTimeout>0&&(this.flushInterval=window.setInterval((()=>this.flush()),this.sendTimeout))}pause(){this.paused=!0,clearInterval(this.flushInterval)}groupItems(e){const t=new Map;return e.forEach((e=>{const n=N(JSON.stringify(e.meta));let r=t.get(n);r=void 0===r?[e]:[...r,e],t.set(n,r)})),Array.from(t.values())}flush(){if(this.paused||0===this.signalBuffer.length)return;this.groupItems(this.signalBuffer).forEach(this.sendFn),this.signalBuffer=[]}}var C;e.TransportItemType=void 0,(C=e.TransportItemType||(e.TransportItemType={})).EXCEPTION="exception",C.LOG="log",C.MEASUREMENT="measurement",C.TRACE="trace",C.EVENT="event";const j={[e.TransportItemType.EXCEPTION]:"exceptions",[e.TransportItemType.LOG]:"logs",[e.TransportItemType.MEASUREMENT]:"measurements",[e.TransportItemType.TRACE]:"traces",[e.TransportItemType.EVENT]:"events"};function k(t){return n=>{if(n.type===e.TransportItemType.EXCEPTION&&n.payload){const e=n.payload,r=`${e.type}: ${e.value}`;if(function(e,t){return e.some((e=>i(e)?t.includes(e):!!t.match(e)))}(t,r))return null}return n}}function w(e,t,n,r){var o;t.debug("Initializing transports");const a=[];let i=n.paused,s=[];const l=e=>{let t=e;for(const e of s){const n=t.map(e).filter(Boolean);if(0===n.length)return[];t=n}return t},u=e=>{const n=l(e);if(0!==n.length)for(const e of a)t.debug(`Transporting item using ${e.name}\n`,n),e.isBatched()&&e.send(n)};let c;(null===(o=n.batching)||void 0===o?void 0:o.enabled)&&(c=new R(u,{sendTimeout:n.batching.sendTimeout,itemLimit:n.batching.itemLimit,paused:i}));return{add:(...o)=>{t.debug("Adding transports"),o.forEach((o=>{t.debug(`Adding "${o.name}" transport`);a.some((e=>e===o))?t.warn(`Transport ${o.name} is already added`):(o.unpatchedConsole=e,o.internalLogger=t,o.config=n,o.metas=r,a.push(o))}))},addBeforeSendHooks:(...e)=>{t.debug("Adding beforeSendHooks\n",s),e.forEach((e=>{e&&s.push(e)}))},addIgnoreErrorsPatterns:(...e)=>{t.debug("Adding ignoreErrorsPatterns\n",e),e.forEach((e=>{e&&s.push(k(e))}))},getBeforeSendHooks:()=>[...s],execute:e=>{var r;i||((null===(r=n.batching)||void 0===r?void 0:r.enabled)&&(null==c||c.addItem(e)),(e=>{var r,o;if((null===(r=n.batching)||void 0===r?void 0:r.enabled)&&a.every((e=>e.isBatched())))return;const[i]=l([e]);if(void 0!==i)for(const e of a)t.debug(`Transporting item using ${e.name}\n`,i),e.isBatched()?(null===(o=n.batching)||void 0===o?void 0:o.enabled)||e.send([i]):e.send(i)})(e))},isPaused:()=>i,pause:()=>{t.debug("Pausing transports"),null==c||c.pause(),i=!0},remove:(...e)=>{t.debug("Removing transports"),e.forEach((e=>{t.debug(`Removing "${e.name}" transport`);const n=a.indexOf(e);-1!==n?a.splice(n,1):t.warn(`Transport "${e.name}" is not added`)}))},removeBeforeSendHooks:(...e)=>{s.filter((t=>!e.includes(t)))},get transports(){return[...a]},unpause:()=>{t.debug("Unpausing transports"),null==c||c.start(),i=!1}}}var P;e.InternalLoggerLevel=void 0,(P=e.InternalLoggerLevel||(e.InternalLoggerLevel={}))[P.OFF=0]="OFF",P[P.ERROR=1]="ERROR",P[P.WARN=2]="WARN",P[P.INFO=3]="INFO",P[P.VERBOSE=4]="VERBOSE";const B={debug:y,error:y,info:y,prefix:"Faro",warn:y},F=e.InternalLoggerLevel.ERROR,D=Object.assign({},console);let _=D;function G(e){var t;return _=null!==(t=e.unpatchedConsole)&&void 0!==t?t:_,_}function $(t=D,n=F){const r=B;return n>e.InternalLoggerLevel.OFF&&(r.error=n>=e.InternalLoggerLevel.ERROR?function(...e){t.error(`${r.prefix}\n`,...e)}:y,r.warn=n>=e.InternalLoggerLevel.WARN?function(...e){t.warn(`${r.prefix}\n`,...e)}:y,r.info=n>=e.InternalLoggerLevel.INFO?function(...e){t.info(`${r.prefix}\n`,...e)}:y,r.debug=n>=e.InternalLoggerLevel.VERBOSE?function(...e){t.debug(`${r.prefix}\n`,...e)}:y),r}let V=B;function M(e,t){return V=$(e,t.internalLoggerLevel),V}class z{constructor(){this.unpatchedConsole=D,this.internalLogger=B,this.config={},this.metas={}}logDebug(...e){this.internalLogger.debug(`${this.name}\n`,...e)}logInfo(...e){this.internalLogger.info(`${this.name}\n`,...e)}logWarn(...e){this.internalLogger.warn(`${this.name}\n`,...e)}logError(...e){this.internalLogger.error(`${this.name}\n`,...e)}}function U(e,t){var n,r;if(void 0===t)return e;if(void 0===e)return{resourceSpans:t};const o=null===(n=e.resourceSpans)||void 0===n?void 0:n[0];if(void 0===o)return e;const a=(null==o?void 0:o.scopeSpans)||[],i=(null===(r=null==t?void 0:t[0])||void 0===r?void 0:r.scopeSpans)||[];return Object.assign(Object.assign({},e),{resourceSpans:[Object.assign(Object.assign({},o),{scopeSpans:[...a,...i]})]})}const K="Error";let H;function W(t,n,r,o,i){n.debug("Initializing API");const s=function(t,n,r,o,a){let i;return n.debug("Initializing traces API"),{getOTEL:()=>i,getTraceContext:()=>{const e=null==i?void 0:i.trace.getSpanContext(i.context.active());return e?{trace_id:e.traceId,span_id:e.spanId}:void 0},initOTEL:(e,t)=>{n.debug("Initializing OpenTelemetry"),i={trace:e,context:t}},isOTELInitialized:()=>!!i,pushTraces:t=>{try{const r={type:e.TransportItemType.TRACE,payload:t,meta:o.value};n.debug("Pushing trace\n",r),a.execute(r)}catch(e){n.error("Error pushing trace\n",e)}}}}(0,n,0,o,i);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},s),function(t,n,r,o,i,s){var l;n.debug("Initializing exceptions API");let u=null;H=null!==(l=r.parseStacktrace)&&void 0!==l?l:H;const c=e=>{n.debug("Changing stacktrace parser"),H=null!=e?e:H};return c(r.parseStacktrace),{changeStacktraceParser:c,getStacktraceParser:()=>H,pushError:(t,{skipDedupe:l,stackFrames:c,type:d,context:g}={})=>{d=d||t.name||K;const p={meta:o.value,payload:{type:d,value:t.message,timestamp:v(),trace:s.getTraceContext(),context:null!=g?g:{}},type:e.TransportItemType.EXCEPTION};(null==(c=null!=c?c:t.stack?null==H?void 0:H(t).frames:void 0)?void 0:c.length)&&(p.payload.stacktrace={frames:c});const f={type:p.payload.type,value:p.payload.value,stackTrace:p.payload.stacktrace,context:p.payload.context};l||!r.dedupe||a(u)||!m(f,u)?(u=f,n.debug("Pushing exception\n",p),i.execute(p)):n.debug("Skipping error push because it is the same as the last one\n",p.payload)}}}(0,n,r,o,i,s)),function(e,t,n,r,o){let a,i,s;t.debug("Initializing meta API");const l=e=>{i&&r.remove(i),i={user:e},r.add(i)},u=e=>{a&&r.remove(a),a={session:e},r.add(a)};return{setUser:l,resetUser:l,setSession:u,resetSession:u,getSession:()=>r.value.session,setView:e=>{var t;if((null===(t=null==s?void 0:s.view)||void 0===t?void 0:t.name)===(null==e?void 0:e.name))return;const n=s;s={view:e},r.add(s),n&&r.remove(n)},getView:()=>r.value.view}}(0,n,0,o)),function(t,n,r,o,i,s){n.debug("Initializing logs API");let l=null;return{pushLog:(t,{context:u,level:c,skipDedupe:d}={})=>{try{const g={type:e.TransportItemType.LOG,payload:{message:t.map((e=>{try{return String(e)}catch(e){return""}})).join(" "),level:null!=c?c:b,context:null!=u?u:{},timestamp:v(),trace:s.getTraceContext()},meta:o.value},p={message:g.payload.message,level:g.payload.level,context:g.payload.context};if(!d&&r.dedupe&&!a(l)&&m(p,l))return void n.debug("Skipping log push because it is the same as the last one\n",g.payload);l=p,n.debug("Pushing log\n",g),i.execute(g)}catch(e){n.error("Error pushing log\n",e)}}}}(0,n,r,o,i,s)),function(t,n,r,o,i,s){n.debug("Initializing measurements API");let l=null;return{pushMeasurement:(t,{skipDedupe:u,context:c}={})=>{var d;try{const g={type:e.TransportItemType.MEASUREMENT,payload:Object.assign(Object.assign({},t),{trace:s.getTraceContext(),timestamp:null!==(d=t.timestamp)&&void 0!==d?d:v(),context:null!=c?c:{}}),meta:o.value},p={type:g.payload.type,values:g.payload.values,context:g.payload.context};if(!u&&r.dedupe&&!a(l)&&m(p,l))return void n.debug("Skipping measurement push because it is the same as the last one\n",g.payload);l=p,n.debug("Pushing measurement\n",g),i.execute(g)}catch(e){n.error("Error pushing measurement\n",e)}}}}(0,n,r,o,i,s)),function(t,n,r,o,i,s){let l=null;return{pushEvent:(t,u,c,{skipDedupe:d}={})=>{try{const g={meta:o.value,payload:{name:t,domain:null!=c?c:r.eventDomain,attributes:u,timestamp:v(),trace:s.getTraceContext()},type:e.TransportItemType.EVENT},p={name:g.payload.name,attributes:g.payload.attributes,domain:g.payload.domain};if(!d&&r.dedupe&&!a(l)&&m(p,l))return void n.debug("Skipping event push because it is the same as the last one\n",g.payload);l=p,n.debug("Pushing event\n",g),i.execute(g)}catch(e){n.error("Error pushing event",e)}}}}(0,n,r,o,i,s))}const X="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0;const q="1.3.5";const J="_faroInternal";function Q(e){e.config.isolate?e.internalLogger.debug("Skipping registering internal Faro instance on global object"):(e.internalLogger.debug("Registering internal Faro instance on global object"),Object.defineProperty(X,J,{configurable:!1,enumerable:!1,writable:!1,value:e}))}function Y(){return J in X}function Z(t,n,r,o,a,i,s){return n.debug("Initializing Faro"),e.faro={api:i,config:r,instrumentations:s,internalLogger:n,metas:o,pause:a.pause,transports:a,unpatchedConsole:t,unpause:a.unpause},Q(e.faro),function(e){if(e.config.preventGlobalExposure)e.internalLogger.debug("Skipping registering public Faro instance in the global scope");else{if(e.internalLogger.debug(`Registering public faro reference in the global scope using "${e.config.globalObjectKey}" key`),e.config.globalObjectKey in X)return void e.internalLogger.warn(`Skipping global registration due to key "${e.config.globalObjectKey}" being used already. Please set "globalObjectKey" to something else or set "preventGlobalExposure" to "true"`);Object.defineProperty(X,e.config.globalObjectKey,{configurable:!1,writable:!1,value:e})}}(e.faro),e.faro}e.faro={};return e.BaseExtension=z,e.BaseInstrumentation=class extends z{constructor(){super(...arguments),this.api={},this.transports={}}},e.BaseTransport=class extends z{isBatched(){return!1}getIgnoreUrls(){return[]}},e.Conventions={EventNames:{CLICK:"click",NAVIGATION:"navigation",SESSION_START:"session_start",VIEW_CHANGED:"view_changed"}},e.EVENT_CLICK="click",e.EVENT_NAVIGATION="navigation",e.EVENT_ROUTE_CHANGE="route_change",e.EVENT_SESSION_EXTEND="session_extend",e.EVENT_SESSION_RESUME="session_resume",e.EVENT_SESSION_START="session_start",e.EVENT_VIEW_CHANGED="view_changed",e.VERSION=q,e.allLogLevels=E,e.createInternalLogger=$,e.createPromiseBuffer=function(e){const{size:t,concurrency:n}=e,r=[];let o=0;const a=()=>{if(o<n&&r.length){const{producer:e,resolve:t,reject:n}=r.shift();o++,e().then((e=>{o--,a(),t(e)}),(e=>{o--,a(),n(e)}))}};return{add:e=>{if(r.length+o>=t)throw new Error("Task buffer full");return new Promise(((t,n)=>{r.push({producer:e,resolve:t,reject:n}),a()}))}}},e.dateNow=function(){return Date.now()},e.deepEqual=m,e.defaultBatchingConfig={enabled:!0,sendTimeout:250,itemLimit:50},e.defaultExceptionType=K,e.defaultGlobalObjectKey="faro",e.defaultInternalLoggerLevel=F,e.defaultLogLevel=b,e.defaultUnpatchedConsole=D,e.genShortID=function(e=10){return Array.from(Array(e)).map((()=>T[Math.floor(Math.random()*T.length)])).join("")},e.getCurrentTimestamp=v,e.getInternalFaroFromGlobalObject=function(){return X[J]},e.getTransportBody=function(t){let n={meta:{}};return void 0!==t[0]&&(n.meta=t[0].meta),t.forEach((t=>{switch(t.type){case e.TransportItemType.LOG:case e.TransportItemType.EVENT:case e.TransportItemType.EXCEPTION:case e.TransportItemType.MEASUREMENT:const r=j[t.type],o=n[r];n=Object.assign(Object.assign({},n),{[r]:void 0===o?[t.payload]:[...o,t.payload]});break;case e.TransportItemType.TRACE:n=Object.assign(Object.assign({},n),{traces:U(n.traces,t.payload.resourceSpans)})}})),n},e.globalObject=X,e.initializeFaro=function(e){const t=G(e),n=M(t,e);if(Y()&&!e.isolate)return void n.error('Faro is already registered. Either add instrumentations, transports etc. to the global faro instance or use the "isolate" property');n.debug("Initializing");const r=function(e,t,n){let r=[],o=[];const a=()=>r.reduce(((e,t)=>Object.assign(e,u(t)?t():t)),{}),i=()=>{if(o.length){const e=a();o.forEach((t=>t(e)))}};return{add:(...e)=>{t.debug("Adding metas\n",e),r.push(...e),i()},remove:(...e)=>{t.debug("Removing metas\n",e),r=r.filter((t=>!e.includes(t))),i()},addListener:e=>{t.debug("Adding metas listener\n",e),o.push(e)},removeListener:e=>{t.debug("Removing metas listener\n",e),o=o.filter((t=>t!==e))},get value(){return a()}}}(0,n),o=w(t,n,e,r),a=W(0,n,e,r,o),i=function(e,t,n,r,o,a){t.debug("Initializing instrumentations");const i=[];return{add:(...s)=>{t.debug("Adding instrumentations"),s.forEach((s=>{t.debug(`Adding "${s.name}" instrumentation`),i.some((e=>e.name===s.name))?t.warn(`Instrumentation ${s.name} is already added`):(s.unpatchedConsole=e,s.internalLogger=t,s.config=n,s.metas=r,s.transports=o,s.api=a,i.push(s),s.initialize())}))},get instrumentations(){return[...i]},remove:(...e)=>{t.debug("Removing instrumentations"),e.forEach((e=>{var n,r;t.debug(`Removing "${e.name}" instrumentation`);const o=i.reduce(((t,n,r)=>null===t&&n.name===e.name?r:null),null);o?(null===(r=(n=i[o]).destroy)||void 0===r||r.call(n),i.splice(o,1)):t.warn(`Instrumentation "${e.name}" is not added`)}))}}}(t,n,e,r,o,a),s=Z(t,n,e,r,o,a,i);return function(e){var t,n;const r={sdk:{version:q}},o=null===(t=e.config.sessionTracking)||void 0===t?void 0:t.session;o&&e.api.setSession(o),e.config.app&&(r.app=e.config.app),e.config.user&&(r.user=e.config.user),e.config.view&&(r.view=e.config.view),e.metas.add(r,...null!==(n=e.config.metas)&&void 0!==n?n:[])}(s),function(e){e.transports.add(...e.config.transports),e.transports.addBeforeSendHooks(e.config.beforeSend),e.transports.addIgnoreErrorsPatterns(e.config.ignoreErrors)}(s),function(e){e.instrumentations.add(...e.config.instrumentations)}(s),s},e.internalGlobalObjectKey=J,e.isArray=c,e.isBoolean=e=>t(e,"boolean"),e.isDomError=e=>n(e,"DOMError"),e.isDomException=e=>n(e,"DOMException"),e.isElement=e=>p&&r(e,Element),e.isElementDefined=p,e.isError=e=>g&&r(e,Error),e.isErrorDefined=g,e.isErrorEvent=e=>n(e,"ErrorEvent"),e.isEvent=e=>d&&r(e,Event),e.isEventDefined=d,e.isFunction=u,e.isInstanceOf=r,e.isInt=e=>s(e)&&Number.isInteger(e),e.isInternalFaroOnGlobalObject=Y,e.isMap=e=>f&&r(e,Map),e.isMapDefined=f,e.isNull=a,e.isNumber=s,e.isObject=l,e.isPrimitive=e=>!l(e)&&!u(e),e.isRegExp=e=>n(e,"RegExp"),e.isString=i,e.isSymbol=e=>t(e,"symbol"),e.isSyntheticEvent=e=>l(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e,e.isThenable=e=>u(null==e?void 0:e.then),e.isToString=n,e.isTypeof=t,e.isUndefined=o,e.noop=y,e.setInternalFaroOnGlobalObject=Q,e.transportItemTypeToBodyKey=j,e}({});
